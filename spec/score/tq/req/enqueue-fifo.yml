SPDX-License-Identifier: CC-BY-SA-4.0 OR BSD-2-Clause
copyrights:
- Copyright (C) 2021 embedded brains GmbH (http://www.embedded-brains.de)
enabled-by: true
functional-type: action
links: []
post-conditions:
- name: Position
  states:
  - name: First
    test-code: |
      T_eq_ptr( GetUnblock( ctx, &i ), GetTCB( ctx, TQ_BLOCKER_A ) );
      T_eq_ptr( GetUnblock( ctx, &i ), NULL );
    text: |
      The thread shall be the first thread in the queue.
  - name: Last
    test-code: |
      T_eq_ptr( GetUnblock( ctx, &i ), GetTCB( ctx, TQ_BLOCKER_B ) );
      T_eq_ptr( GetUnblock( ctx, &i ), GetTCB( ctx, TQ_BLOCKER_A ) );
      T_eq_ptr( GetUnblock( ctx, &i ), NULL );
    text: |
      The thread shall be the last thread in the queue.
  test-epilogue: null
  test-prologue: |
    size_t i;

    i = 0;

    /* Event receive */
    T_eq_ptr( GetUnblock( ctx, &i ), GetTCB( ctx, TQ_BLOCKER_A ) );

    /* Enqueue */
    T_eq_ptr( GetBlock( ctx, &i ), GetTCB( ctx, TQ_BLOCKER_A ) );
pre-conditions:
- name: Queue
  states:
  - name: Empty
    test-code: |
      /* This is the default */
    text: |
      While the queue is empty.
  - name: NonEmpty
    test-code: |
      TQSend(
        ctx->tq_ctx,
        TQ_BLOCKER_B,
        TQ_EVENT_ENQUEUE | TQ_EVENT_DEQUEUE_ONE
      );
    text: |
      While the queue is non-empty.
  test-epilogue: null
  test-prologue: null
rationale: null
references: []
requirement-type: functional
skip-reasons: {}
test-action: |
  TQSchedulerRecordStart( ctx->tq_ctx );
  TQSend( ctx->tq_ctx, TQ_BLOCKER_A, TQ_EVENT_ENQUEUE | TQ_EVENT_DEQUEUE_ONE );
  TQDequeueAll( ctx->tq_ctx );
  TQSchedulerRecordStop( ctx->tq_ctx );
test-brief: null
test-cleanup: |
  TQCleanup( ctx->tq_ctx );
test-context: []
test-context-support: null
test-description: null
test-header:
  code: null
  includes: []
  local-includes:
  - tx-thread-queue.h
  run-params:
  - description: |
      is the thread queue context.
    dir: inout
    name: tq_ctx
    specifier: TQContext *${.:name}
  target: testsuites/validation/tr-tq-enqueue-fifo.h
test-includes: []
test-local-includes:
- tr-tq-enqueue-fifo.h
test-prepare: |
  TQPrepare( ctx->tq_ctx );
test-setup: null
test-stop: null
test-support: |
  typedef ScoreTqReqEnqueueFifo_Context Context;

  static const rtems_tcb *GetBlock( Context *ctx, size_t *index )
  {
    return TQGetNextBlock( ctx->tq_ctx, index )->thread;
  }

  static const rtems_tcb *GetUnblock( Context *ctx, size_t *index )
  {
    return TQGetNextUnblock( ctx->tq_ctx, index )->thread;
  }

  static const rtems_tcb *GetTCB( Context *ctx, TQWorkerKind worker )
  {
    return ctx->tq_ctx->worker_tcb[ worker ];
  }
test-target: testsuites/validation/tr-tq-enqueue-fifo.c
test-teardown: null
text: ${.:text-template}
transition-map:
- enabled-by: true
  post-conditions:
    Position: First
  pre-conditions:
    Queue:
    - Empty
- enabled-by: true
  post-conditions:
    Position: Last
  pre-conditions:
    Queue:
    - NonEmpty
type: requirement
