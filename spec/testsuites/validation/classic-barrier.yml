SPDX-License-Identifier: CC-BY-SA-4.0 OR BSD-2-Clause
copyrights:
- Copyright (C) 2020 embedded brains GmbH (http://www.embedded-brains.de)
enabled-by: true
links: []
test-actions:
- action-brief: |
    Set an object identifier to an invalid value and create an automatic
    release barrier object for one task.
  action-code: |
    rtems_status_code sc;

    ctx->id = 0xffffffff;
    sc = rtems_barrier_create(
      name,
      RTEMS_BARRIER_AUTOMATIC_RELEASE,
      1,
      &ctx->id
    );
  checks:
  - brief: |
      Check that the barrier creation was successful.
    code: |
      T_step_rsc_success(${step}, sc);
    links: []
  links: []
- action-brief: |
    Set a second object identifier to an invalid value and identify a barrier
    object by its name.
  action-code: |
    rtems_status_code sc;
    rtems_id          id;

    id = 0xffffffff;
    sc = rtems_barrier_ident(name, &id);
  checks:
  - brief: |
      Check that the barrier identification by name was successful.
    code: |
      T_step_rsc_success(${step}, sc);
    links: []
  - brief: |
      Check that the second identifier is equal to the one returned by the
      barrier creation.
    code: |
      T_step_eq_u32(${step}, id, ctx->id);
    links: []
  links: []
- action-brief: |
    Set the count of released tasks to one and release the barrier.
  action-code: |
    rtems_status_code sc;
    uint32_t          released;

    released = 1;
    sc = rtems_barrier_release(ctx->id, &released);
  checks:
  - brief: |
      Check that the barrier release was successful.
    code: |
      T_step_rsc_success(${step}, sc);
    links: []
  - brief: |
      Check that the count of released tasks is zero.
    code: |
      T_step_eq_u32(${step}, released, 0);
    links: []
  links: []
- action-brief: |
    Wait with an infinite timeout for the barrier.
  action-code: |
    rtems_status_code sc;

    sc = rtems_barrier_wait(ctx->id, RTEMS_NO_TIMEOUT);
  checks:
  - brief: |
      Check that the barrier wait was successful.
    code: |
      T_step_rsc_success(${step}, sc);
    links: []
  links: []
test-brief: |
  This test case calls functions of the Barrier Manager which are included in
  the space profile.
test-context:
- brief: null
  description: null
  member: |
    rtems_id id
test-context-support: null
test-description: null
test-header: null
test-includes:
- rtems.h
test-local-includes: []
test-setup: null
test-stop: null
test-support: |
  static const rtems_name name = rtems_build_name( 'B', 'A', 'R', 'R' );
test-target: testsuites/validation/tc-space-profile.c
test-teardown:
  brief: null
  code: |
    T_check_rtems_barriers(T_EVENT_RUN_INITIALIZE_EARLY, T_case_name());
  description: null
type: test-case
